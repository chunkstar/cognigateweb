{"version":3,"sources":["../src/utils/errors.ts","../src/providers/base.ts","../src/providers/cloud/openai.ts","../src/providers/cloud/anthropic.ts","../src/providers/cloud/google.ts","../src/providers/local/ollama.ts","../src/providers/local/lmstudio.ts","../src/providers/local/webllm.ts","../src/core/alert-manager.ts","../src/core/budget-manager.ts","../src/core/cache-manager.ts","../src/core/compressor.ts","../src/webhooks/slack.ts","../src/webhooks/discord.ts","../src/webhooks/webhook-manager.ts","../src/core/gateway.ts","../src/voice/types.ts","../src/voice/recognizer.ts","../src/voice/speaker.ts","../src/voice/conversation.ts","../src/index.ts"],"names":["formatBudgetAlert"],"mappings":"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","file":"index.js","sourcesContent":["/**\n * Base error class for Cognigate\n */\nexport class CognigateError extends Error {\n  constructor(message: string) {\n    super(message);\n    this.name = 'CognigateError';\n    // Maintains proper stack trace for where our error was thrown (only available on V8)\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, this.constructor);\n    }\n  }\n}\n\n/**\n * Error thrown when daily budget is exceeded\n */\nexport class BudgetExceededError extends CognigateError {\n  public readonly used: number;\n  public readonly limit: number;\n\n  constructor(used: number, limit: number) {\n    super(\n      `Daily budget exceeded: $${used.toFixed(2)} / $${limit.toFixed(2)}. ` +\n      `Enable local fallback to continue with free local models, or increase your daily budget.`\n    );\n    this.name = 'BudgetExceededError';\n    this.used = used;\n    this.limit = limit;\n  }\n}\n\n/**\n * Error thrown when a provider is unavailable\n */\nexport class ProviderUnavailableError extends CognigateError {\n  public readonly provider: string;\n\n  constructor(provider: string, details?: string) {\n    const message = details\n      ? `Provider unavailable: ${provider}. ${details}`\n      : `Provider unavailable: ${provider}. Check your configuration and network connection.`;\n\n    super(message);\n    this.name = 'ProviderUnavailableError';\n    this.provider = provider;\n  }\n}\n\n/**\n * Error thrown for cache-related issues\n */\nexport class CacheError extends CognigateError {\n  constructor(message: string) {\n    super(`Cache error: ${message}`);\n    this.name = 'CacheError';\n  }\n}\n\n/**\n * Error thrown for voice mode issues\n */\nexport class VoiceModeError extends CognigateError {\n  constructor(message: string) {\n    super(`Voice mode error: ${message}`);\n    this.name = 'VoiceModeError';\n  }\n}\n\n/**\n * Error thrown for configuration validation failures\n */\nexport class ConfigurationError extends CognigateError {\n  constructor(message: string) {\n    super(`Configuration error: ${message}`);\n    this.name = 'ConfigurationError';\n  }\n}\n","import type { Provider, CompletionOptions, CompletionResult } from '../utils/types.js';\n\n/**\n * Base class for all providers\n */\nexport abstract class BaseProvider implements Provider {\n  abstract name: string;\n  abstract type: 'cloud' | 'local';\n\n  /**\n   * Check if provider is available\n   */\n  abstract isAvailable(): Promise<boolean>;\n\n  /**\n   * Complete a prompt\n   */\n  abstract complete(prompt: string, options?: CompletionOptions): Promise<CompletionResult>;\n\n  /**\n   * Stream a completion response token-by-token\n   *\n   * Default implementation simulates streaming by chunking the complete() response.\n   * Providers with native streaming support should override this method.\n   *\n   * @param prompt - The text prompt to complete\n   * @param options - Optional completion options\n   * @returns Async iterator yielding response tokens\n   */\n  async *stream(prompt: string, options?: CompletionOptions): AsyncIterable<string> {\n    // Get the complete response\n    const result = await this.complete(prompt, options);\n\n    // Chunk the response to simulate streaming\n    // Use smaller chunks (~5 chars) to simulate token-level streaming\n    const chunkSize = 5;\n    const text = result.text;\n\n    for (let i = 0; i < text.length; i += chunkSize) {\n      const chunk = text.slice(i, i + chunkSize);\n      yield chunk;\n\n      // Add small delay to simulate network latency (< 50ms as per requirements)\n      await new Promise(resolve => setTimeout(resolve, 10));\n    }\n  }\n\n  /**\n   * Estimate cost for a prompt\n   */\n  abstract estimateCost(prompt: string): number;\n\n  /**\n   * Estimate token count for text\n   * Rough estimate: 1 token  4 characters\n   */\n  protected estimateTokens(text: string): number {\n    return Math.ceil(text.length / 4);\n  }\n}\n","import { BaseProvider } from '../base.js';\nimport type { ProviderConfig, CompletionOptions, CompletionResult } from '../../utils/types.js';\nimport { ProviderUnavailableError } from '../../utils/errors.js';\n\n/**\n * OpenAI provider implementation\n */\nexport class OpenAIProvider extends BaseProvider {\n  name = 'openai';\n  type = 'cloud' as const;\n\n  private apiKey: string;\n  private baseUrl: string;\n  private models: string[];\n\n  constructor(config: ProviderConfig) {\n    super();\n    this.apiKey = config.apiKey;\n    this.baseUrl = config.baseUrl || 'https://api.openai.com/v1';\n    this.models = config.models || ['gpt-4o-mini', 'gpt-4o'];\n  }\n\n  async isAvailable(): Promise<boolean> {\n    return !!this.apiKey && this.apiKey.length > 0;\n  }\n\n  async complete(prompt: string, options?: CompletionOptions): Promise<CompletionResult> {\n    if (!await this.isAvailable()) {\n      throw new ProviderUnavailableError(\n        'openai',\n        'API key is missing or invalid'\n      );\n    }\n\n    const model = options?.model || this.models[0]!;\n    const temperature = options?.temperature ?? 0.7;\n    const maxTokens = options?.maxTokens ?? 1000;\n\n    try {\n      const response = await fetch(`${this.baseUrl}/chat/completions`, {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${this.apiKey}`,\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          model,\n          messages: [{ role: 'user', content: prompt }],\n          temperature,\n          max_tokens: maxTokens,\n        }),\n      });\n\n      if (!response.ok) {\n        const errorText = await response.text();\n        throw new ProviderUnavailableError(\n          'openai',\n          `API error (${response.status}): ${errorText}`\n        );\n      }\n\n      const data = await response.json() as {\n        choices?: Array<{ message?: { content?: string } }>;\n        usage?: { total_tokens?: number };\n      };\n\n      const text = data.choices?.[0]?.message?.content || '';\n      const tokens = data.usage?.total_tokens || this.estimateTokens(prompt + text);\n      const cost = this.calculateCost(tokens, model);\n\n      return {\n        text,\n        tokens,\n        cost,\n        provider: this.name,\n        cached: false,\n      };\n    } catch (error) {\n      if (error instanceof ProviderUnavailableError) {\n        throw error;\n      }\n\n      throw new ProviderUnavailableError(\n        'openai',\n        `Failed to complete request: ${error instanceof Error ? error.message : 'Unknown error'}`\n      );\n    }\n  }\n\n  estimateCost(prompt: string): number {\n    const tokens = this.estimateTokens(prompt);\n    const model = this.models[0]!;\n    return this.calculateCost(tokens * 2, model); // Rough estimate: 2x for input+output\n  }\n\n  /**\n   * Calculate cost based on OpenAI pricing (as of 2025)\n   * Prices per 1M tokens\n   */\n  private calculateCost(tokens: number, model: string): number {\n    const pricing: Record<string, { input: number; output: number }> = {\n      'gpt-4o-mini': { input: 0.15, output: 0.60 },\n      'gpt-4o': { input: 2.50, output: 10.00 },\n      'gpt-4-turbo': { input: 10.00, output: 30.00 },\n      'gpt-4': { input: 30.00, output: 60.00 },\n    };\n\n    const rate = pricing[model] || pricing['gpt-4o-mini']!;\n\n    // Assume 50/50 split between input and output tokens\n    const inputTokens = tokens / 2;\n    const outputTokens = tokens / 2;\n\n    const cost = (\n      (inputTokens * rate.input) +\n      (outputTokens * rate.output)\n    ) / 1_000_000;\n\n    return cost;\n  }\n}\n","import { BaseProvider } from '../base.js';\nimport type { ProviderConfig, CompletionOptions, CompletionResult } from '../../utils/types.js';\nimport { ProviderUnavailableError } from '../../utils/errors.js';\n\n/**\n * Anthropic provider implementation\n *\n * Provides access to Claude models via the Anthropic Messages API\n */\nexport class AnthropicProvider extends BaseProvider {\n  name = 'anthropic';\n  type = 'cloud' as const;\n\n  private apiKey: string;\n  private baseUrl: string;\n  private models: string[];\n\n  constructor(config: ProviderConfig) {\n    super();\n    this.apiKey = config.apiKey;\n    this.baseUrl = config.baseUrl || 'https://api.anthropic.com/v1';\n    this.models = config.models || ['claude-3-5-haiku-20241022', 'claude-3-5-sonnet-20241022'];\n  }\n\n  async isAvailable(): Promise<boolean> {\n    return !!this.apiKey && this.apiKey.length > 0;\n  }\n\n  async complete(prompt: string, options?: CompletionOptions): Promise<CompletionResult> {\n    if (!await this.isAvailable()) {\n      throw new ProviderUnavailableError(\n        'anthropic',\n        'API key is missing or invalid'\n      );\n    }\n\n    const model = options?.model || this.models[0]!;\n    const temperature = options?.temperature ?? 0.7;\n    const maxTokens = options?.maxTokens ?? 1000;\n\n    try {\n      const response = await fetch(`${this.baseUrl}/messages`, {\n        method: 'POST',\n        headers: {\n          'x-api-key': this.apiKey,\n          'anthropic-version': '2023-06-01',\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          model,\n          messages: [{ role: 'user', content: prompt }],\n          temperature,\n          max_tokens: maxTokens,\n        }),\n      });\n\n      if (!response.ok) {\n        const errorText = await response.text();\n        throw new ProviderUnavailableError(\n          'anthropic',\n          `API error (${response.status}): ${errorText}`\n        );\n      }\n\n      const data = await response.json() as {\n        content?: Array<{ text?: string }>;\n        usage?: { input_tokens?: number; output_tokens?: number };\n      };\n\n      const text = data.content?.[0]?.text || '';\n      const inputTokens = data.usage?.input_tokens || 0;\n      const outputTokens = data.usage?.output_tokens || 0;\n      const tokens = inputTokens + outputTokens;\n      const cost = this.calculateCost(inputTokens, outputTokens, model);\n\n      return {\n        text,\n        tokens,\n        cost,\n        provider: this.name,\n        cached: false,\n      };\n    } catch (error) {\n      if (error instanceof ProviderUnavailableError) {\n        throw error;\n      }\n\n      throw new ProviderUnavailableError(\n        'anthropic',\n        `Failed to complete request: ${error instanceof Error ? error.message : 'Unknown error'}`\n      );\n    }\n  }\n\n  estimateCost(prompt: string): number {\n    const tokens = this.estimateTokens(prompt);\n    const model = this.models[0]!;\n    // Rough estimate: assume 2x for output\n    return this.calculateCost(tokens, tokens, model);\n  }\n\n  /**\n   * Calculate cost based on Anthropic pricing (as of 2025)\n   * Prices per 1M tokens\n   */\n  private calculateCost(inputTokens: number, outputTokens: number, model: string): number {\n    const pricing: Record<string, { input: number; output: number }> = {\n      'claude-3-5-sonnet-20241022': { input: 3.00, output: 15.00 },\n      'claude-3-5-haiku-20241022': { input: 0.80, output: 4.00 },\n      'claude-3-opus-20240229': { input: 15.00, output: 75.00 },\n      'claude-3-sonnet-20240229': { input: 3.00, output: 15.00 },\n      'claude-3-haiku-20240307': { input: 0.25, output: 1.25 },\n    };\n\n    const rate = pricing[model] || pricing['claude-3-5-haiku-20241022']!;\n\n    const cost = (\n      (inputTokens * rate.input) +\n      (outputTokens * rate.output)\n    ) / 1_000_000;\n\n    return cost;\n  }\n}\n","import { BaseProvider } from '../base.js';\nimport type { ProviderConfig, CompletionOptions, CompletionResult } from '../../utils/types.js';\nimport { ProviderUnavailableError } from '../../utils/errors.js';\n\n/**\n * Google Gemini provider implementation\n *\n * Provides access to Gemini models via the Google AI API\n * @see https://ai.google.dev/docs\n */\nexport class GoogleProvider extends BaseProvider {\n  name = 'google';\n  type = 'cloud' as const;\n\n  private apiKey: string;\n  private baseUrl: string;\n  private models: string[];\n\n  constructor(config: ProviderConfig) {\n    super();\n    this.apiKey = config.apiKey;\n    this.baseUrl = config.baseUrl || 'https://generativelanguage.googleapis.com/v1beta';\n    this.models = config.models || ['gemini-2.5-flash', 'gemini-2.5-pro', 'gemini-2.0-flash'];\n  }\n\n  async isAvailable(): Promise<boolean> {\n    return !!this.apiKey && this.apiKey.length > 0;\n  }\n\n  async complete(prompt: string, options?: CompletionOptions): Promise<CompletionResult> {\n    if (!await this.isAvailable()) {\n      throw new ProviderUnavailableError(\n        'google',\n        'API key is missing or invalid'\n      );\n    }\n\n    const model = options?.model || this.models[0]!;\n    const temperature = options?.temperature ?? 0.7;\n    const maxTokens = options?.maxTokens ?? 1000;\n\n    try {\n      // Google uses a different endpoint format with API key in URL\n      const url = `${this.baseUrl}/models/${model}:generateContent?key=${this.apiKey}`;\n\n      const response = await fetch(url, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          contents: [{\n            parts: [{ text: prompt }]\n          }],\n          generationConfig: {\n            temperature,\n            maxOutputTokens: maxTokens,\n          },\n        }),\n      });\n\n      if (!response.ok) {\n        const errorText = await response.text();\n        throw new ProviderUnavailableError(\n          'google',\n          `API error (${response.status}): ${errorText}`\n        );\n      }\n\n      const data = await response.json() as {\n        candidates?: Array<{\n          content?: {\n            parts?: Array<{ text?: string }>;\n          };\n        }>;\n        usageMetadata?: {\n          promptTokenCount?: number;\n          candidatesTokenCount?: number;\n          totalTokenCount?: number;\n        };\n      };\n\n      const text = data.candidates?.[0]?.content?.parts?.[0]?.text || '';\n      const tokens = data.usageMetadata?.totalTokenCount || 0;\n      const cost = this.calculateCost(\n        data.usageMetadata?.promptTokenCount || 0,\n        data.usageMetadata?.candidatesTokenCount || 0,\n        model\n      );\n\n      return {\n        text,\n        tokens,\n        cost,\n        provider: this.name,\n        cached: false,\n      };\n    } catch (error) {\n      if (error instanceof ProviderUnavailableError) {\n        throw error;\n      }\n\n      throw new ProviderUnavailableError(\n        'google',\n        `Failed to complete request: ${error instanceof Error ? error.message : 'Unknown error'}`\n      );\n    }\n  }\n\n  estimateCost(prompt: string): number {\n    const tokens = this.estimateTokens(prompt);\n    const model = this.models[0]!;\n    // Rough estimate: assume 2x for output\n    return this.calculateCost(tokens, tokens, model);\n  }\n\n  /**\n   * Calculate cost based on Google Gemini pricing (as of 2025)\n   * Prices per 1M tokens\n   */\n  private calculateCost(inputTokens: number, outputTokens: number, model: string): number {\n    const pricing: Record<string, { input: number; output: number }> = {\n      'gemini-2.5-flash': { input: 0.075, output: 0.30 },\n      'gemini-2.5-pro': { input: 1.25, output: 5.00 },\n      'gemini-2.0-flash': { input: 0.075, output: 0.30 },\n      'gemini-1.5-flash': { input: 0.075, output: 0.30 },\n      'gemini-1.5-pro': { input: 1.25, output: 5.00 },\n      'gemini-1.0-pro': { input: 0.50, output: 1.50 },\n    };\n\n    const rate = pricing[model] || pricing['gemini-2.5-flash']!;\n\n    const cost = (\n      (inputTokens * rate.input) +\n      (outputTokens * rate.output)\n    ) / 1_000_000;\n\n    return cost;\n  }\n}\n","import { BaseProvider } from '../base.js';\nimport type { ProviderConfig, CompletionOptions, CompletionResult } from '../../utils/types.js';\nimport { ProviderUnavailableError } from '../../utils/errors.js';\n\n/**\n * Ollama provider implementation\n *\n * Provides access to local LLMs via Ollama\n * @see https://ollama.ai/\n */\nexport class OllamaProvider extends BaseProvider {\n  name = 'ollama';\n  type = 'local' as const;\n\n  private baseUrl: string;\n  private models: string[];\n\n  constructor(config: Partial<ProviderConfig> = {}) {\n    super();\n    // Ollama doesn't require an API key (it's local)\n    this.baseUrl = config.baseUrl || 'http://localhost:11434';\n    this.models = config.models || ['llama2', 'codellama', 'mistral'];\n  }\n\n  /**\n   * Check if Ollama is available by pinging the health endpoint\n   */\n  async isAvailable(): Promise<boolean> {\n    try {\n      const response = await fetch(`${this.baseUrl}/api/tags`, {\n        method: 'GET',\n      });\n      return response.ok;\n    } catch {\n      // Ollama is not running or not accessible\n      return false;\n    }\n  }\n\n  async complete(prompt: string, options?: CompletionOptions): Promise<CompletionResult> {\n    if (!await this.isAvailable()) {\n      throw new ProviderUnavailableError(\n        'ollama',\n        'Ollama is not available. Make sure Ollama is installed and running at ' + this.baseUrl\n      );\n    }\n\n    const model = options?.model || this.models[0]!;\n    const temperature = options?.temperature ?? 0.7;\n\n    try {\n      const response = await fetch(`${this.baseUrl}/api/generate`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          model,\n          prompt,\n          temperature,\n          stream: false, // We want the complete response at once\n        }),\n      });\n\n      if (!response.ok) {\n        const errorText = await response.text();\n        throw new ProviderUnavailableError(\n          'ollama',\n          `API error (${response.status}): ${errorText}`\n        );\n      }\n\n      const data = await response.json() as {\n        response?: string;\n        context?: number[];\n        done?: boolean;\n      };\n\n      const text = data.response || '';\n\n      // Ollama doesn't return token counts in non-streaming mode,\n      // so we estimate based on text length\n      const tokens = this.estimateTokens(prompt + text);\n\n      // Local models are free!\n      const cost = 0;\n\n      return {\n        text,\n        tokens,\n        cost,\n        provider: this.name,\n        cached: false,\n      };\n    } catch (error) {\n      if (error instanceof ProviderUnavailableError) {\n        throw error;\n      }\n\n      throw new ProviderUnavailableError(\n        'ollama',\n        `Failed to complete request: ${error instanceof Error ? error.message : 'Unknown error'}`\n      );\n    }\n  }\n\n  estimateCost(prompt: string): number {\n    // Local models are always free\n    return 0;\n  }\n}\n","import { BaseProvider } from '../base.js';\nimport type { ProviderConfig, CompletionOptions, CompletionResult } from '../../utils/types.js';\nimport { ProviderUnavailableError } from '../../utils/errors.js';\n\n/**\n * LM Studio provider implementation\n *\n * Provides access to local LLMs via LM Studio's OpenAI-compatible API\n * @see https://lmstudio.ai/\n */\nexport class LMStudioProvider extends BaseProvider {\n  name = 'lmstudio';\n  type = 'local' as const;\n\n  private baseUrl: string;\n  private models: string[];\n\n  constructor(config: Partial<ProviderConfig> = {}) {\n    super();\n    // LM Studio doesn't require an API key (it's local)\n    this.baseUrl = config.baseUrl || 'http://localhost:1234/v1';\n    this.models = config.models || ['local-model']; // LM Studio auto-detects loaded model\n  }\n\n  /**\n   * Check if LM Studio is available by pinging the models endpoint\n   */\n  async isAvailable(): Promise<boolean> {\n    try {\n      const response = await fetch(`${this.baseUrl}/models`, {\n        method: 'GET',\n      });\n      return response.ok;\n    } catch {\n      // LM Studio is not running or not accessible\n      return false;\n    }\n  }\n\n  async complete(prompt: string, options?: CompletionOptions): Promise<CompletionResult> {\n    if (!await this.isAvailable()) {\n      throw new ProviderUnavailableError(\n        'lmstudio',\n        'LM Studio is not available. Make sure LM Studio is installed and running at ' + this.baseUrl\n      );\n    }\n\n    const model = options?.model || this.models[0]!;\n    const temperature = options?.temperature ?? 0.7;\n    const maxTokens = options?.maxTokens ?? 1000;\n\n    try {\n      // LM Studio uses OpenAI-compatible API format\n      const response = await fetch(`${this.baseUrl}/chat/completions`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          model,\n          messages: [{ role: 'user', content: prompt }],\n          temperature,\n          max_tokens: maxTokens,\n        }),\n      });\n\n      if (!response.ok) {\n        const errorText = await response.text();\n        throw new ProviderUnavailableError(\n          'lmstudio',\n          `API error (${response.status}): ${errorText}`\n        );\n      }\n\n      const data = await response.json() as {\n        choices?: Array<{ message?: { content?: string } }>;\n        usage?: { total_tokens?: number };\n      };\n\n      const text = data.choices?.[0]?.message?.content || '';\n      const tokens = data.usage?.total_tokens || this.estimateTokens(prompt + text);\n\n      // Local models are free!\n      const cost = 0;\n\n      return {\n        text,\n        tokens,\n        cost,\n        provider: this.name,\n        cached: false,\n      };\n    } catch (error) {\n      if (error instanceof ProviderUnavailableError) {\n        throw error;\n      }\n\n      throw new ProviderUnavailableError(\n        'lmstudio',\n        `Failed to complete request: ${error instanceof Error ? error.message : 'Unknown error'}`\n      );\n    }\n  }\n\n  estimateCost(prompt: string): number {\n    // Local models are always free\n    return 0;\n  }\n}\n","import { BaseProvider } from '../base.js';\nimport type { ProviderConfig, CompletionOptions, CompletionResult } from '../../utils/types.js';\nimport { ProviderUnavailableError } from '../../utils/errors.js';\n\n/**\n * WebLLM provider implementation\n *\n * Provides access to browser-based LLMs via WebLLM (requires WebGPU)\n * Note: This provider only works in browser environments with WebGPU support\n * @see https://webllm.mlc.ai/\n */\nexport class WebLLMProvider extends BaseProvider {\n  name = 'webllm';\n  type = 'local' as const;\n\n  private models: string[];\n  private engine: any = null; // Will be MLCEngine instance in browser\n\n  constructor(config: Partial<ProviderConfig> = {}) {\n    super();\n    // WebLLM doesn't require an API key (it's browser-based)\n    this.models = config.models || ['Llama-3.1-8B-Instruct-q4f32_1-MLC'];\n  }\n\n  /**\n   * Check if WebLLM is available (requires browser environment with WebGPU)\n   */\n  async isAvailable(): Promise<boolean> {\n    // Check if we're in a browser environment\n    if (typeof window === 'undefined' || typeof navigator === 'undefined') {\n      return false;\n    }\n\n    // Check if WebGPU is available\n    if (!('gpu' in navigator)) {\n      return false;\n    }\n\n    return true;\n  }\n\n  async complete(prompt: string, options?: CompletionOptions): Promise<CompletionResult> {\n    if (!await this.isAvailable()) {\n      throw new ProviderUnavailableError(\n        'webllm',\n        'WebLLM is only available in browser environments with WebGPU support. ' +\n        'This provider cannot run in Node.js or non-WebGPU browsers.'\n      );\n    }\n\n    const model = options?.model || this.models[0]!;\n    const temperature = options?.temperature ?? 0.7;\n    const maxTokens = options?.maxTokens ?? 1000;\n\n    try {\n      // Initialize engine if not already done\n      if (!this.engine) {\n        // Dynamic import for browser-only code\n        // In a real browser environment, this would import @mlc-ai/web-llm\n        const { CreateMLCEngine } = await import('@mlc-ai/web-llm');\n        this.engine = await CreateMLCEngine(model);\n      }\n\n      // WebLLM uses OpenAI-compatible chat completion API\n      const response = await this.engine.chat.completions.create({\n        messages: [{ role: 'user', content: prompt }],\n        temperature,\n        max_tokens: maxTokens,\n        stream: false,\n      });\n\n      const text = response.choices?.[0]?.message?.content || '';\n      const tokens = response.usage?.total_tokens || this.estimateTokens(prompt + text);\n\n      // Browser-based models are free!\n      const cost = 0;\n\n      return {\n        text,\n        tokens,\n        cost,\n        provider: this.name,\n        cached: false,\n      };\n    } catch (error) {\n      if (error instanceof ProviderUnavailableError) {\n        throw error;\n      }\n\n      throw new ProviderUnavailableError(\n        'webllm',\n        `Failed to complete request: ${error instanceof Error ? error.message : 'Unknown error'}`\n      );\n    }\n  }\n\n  estimateCost(prompt: string): number {\n    // Browser-based models are always free\n    return 0;\n  }\n\n  /**\n   * Clean up resources when done\n   */\n  async cleanup(): Promise<void> {\n    if (this.engine) {\n      try {\n        await this.engine.unload();\n        this.engine = null;\n      } catch (error) {\n        // Ignore cleanup errors\n      }\n    }\n  }\n}\n","import type { BudgetAlertData, AlertPayload } from '../webhooks/types.js';\n\n/**\n * Budget threshold configuration\n */\nexport interface AlertThresholds {\n  warning: number;   // 50% default\n  urgent: number;    // 80% default\n  critical: number;  // 100% (exceeded)\n}\n\n/**\n * Alert manager for budget monitoring\n *\n * Tracks budget usage and triggers alerts when thresholds are crossed.\n * Ensures alerts are only sent once per threshold per day.\n */\nexport class AlertManager {\n  private thresholds: AlertThresholds;\n  private firedAlerts: Set<string> = new Set();\n  private listeners: Map<string, Set<Function>> = new Map();\n\n  constructor(thresholds?: Partial<AlertThresholds>) {\n    this.thresholds = {\n      warning: thresholds?.warning ?? 50,\n      urgent: thresholds?.urgent ?? 80,\n      critical: thresholds?.critical ?? 100,\n    };\n  }\n\n  /**\n   * Check budget usage and trigger alerts if thresholds crossed\n   *\n   * @param dailyLimit - Daily budget limit\n   * @param used - Amount used so far\n   * @param resetAt - When budget resets\n   */\n  checkBudget(dailyLimit: number, used: number, resetAt: Date): void {\n    // If unlimited budget, no alerts\n    if (dailyLimit === 0) {\n      return;\n    }\n\n    const percentage = (used / dailyLimit) * 100;\n    const remaining = dailyLimit - used;\n\n    const data: BudgetAlertData = {\n      dailyLimit,\n      used,\n      remaining,\n      percentage,\n      resetAt: resetAt.toISOString(),\n    };\n\n    // Check critical (100% exceeded)\n    if (percentage >= this.thresholds.critical && !this.hasFired('critical')) {\n      this.fireAlert('budget_exceeded', 'critical', data);\n      this.markFired('critical');\n    }\n    // Check urgent (80%)\n    else if (percentage >= this.thresholds.urgent && !this.hasFired('urgent')) {\n      this.fireAlert('budget_urgent', 'urgent', data);\n      this.markFired('urgent');\n    }\n    // Check warning (50%)\n    else if (percentage >= this.thresholds.warning && !this.hasFired('warning')) {\n      this.fireAlert('budget_warning', 'warning', data);\n      this.markFired('warning');\n    }\n  }\n\n  /**\n   * Fire an alert to all listeners\n   */\n  private fireAlert(\n    event: 'budget_warning' | 'budget_urgent' | 'budget_exceeded',\n    severity: 'warning' | 'urgent' | 'critical',\n    data: BudgetAlertData\n  ): void {\n    const payload: AlertPayload = {\n      event,\n      timestamp: new Date().toISOString(),\n      severity,\n      data,\n    };\n\n    this.emit('alert', payload);\n  }\n\n  /**\n   * Check if alert has already fired\n   */\n  private hasFired(threshold: string): boolean {\n    return this.firedAlerts.has(threshold);\n  }\n\n  /**\n   * Mark alert as fired\n   */\n  private markFired(threshold: string): void {\n    this.firedAlerts.add(threshold);\n  }\n\n  /**\n   * Reset fired alerts (called on budget reset)\n   */\n  reset(): void {\n    this.firedAlerts.clear();\n  }\n\n  /**\n   * Register event listener\n   *\n   * @param event - Event name ('alert')\n   * @param callback - Event callback\n   */\n  on(event: string, callback: Function): void {\n    if (!this.listeners.has(event)) {\n      this.listeners.set(event, new Set());\n    }\n\n    this.listeners.get(event)!.add(callback);\n  }\n\n  /**\n   * Remove event listener\n   *\n   * @param event - Event name\n   * @param callback - Event callback\n   */\n  off(event: string, callback: Function): void {\n    const callbacks = this.listeners.get(event);\n    if (callbacks) {\n      callbacks.delete(callback);\n    }\n  }\n\n  /**\n   * Emit event to all listeners\n   */\n  private emit(event: string, data?: any): void {\n    const callbacks = this.listeners.get(event);\n    if (callbacks) {\n      callbacks.forEach(callback => {\n        try {\n          callback(data);\n        } catch (error) {\n          // Log error but don't throw - webhook failures shouldn't crash app\n          console.error(`Alert listener error:`, error);\n        }\n      });\n    }\n  }\n\n  /**\n   * Get current thresholds\n   */\n  getThresholds(): Readonly<AlertThresholds> {\n    return { ...this.thresholds };\n  }\n}\n","import type { BudgetStatus } from '../utils/types.js';\nimport { BudgetExceededError } from '../utils/errors.js';\nimport { AlertManager } from './alert-manager.js';\n\n/**\n * Manages daily budget tracking and enforcement\n */\nexport class BudgetManager {\n  private dailyLimit: number;\n  private used: number = 0;\n  private resetAt: Date;\n  private alertManager: AlertManager;\n\n  constructor(dailyLimit: number, alertManager?: AlertManager) {\n    this.dailyLimit = dailyLimit;\n    this.resetAt = this.calculateNextReset();\n    this.alertManager = alertManager || new AlertManager();\n  }\n\n  /**\n   * Calculate the next midnight UTC reset time\n   */\n  private calculateNextReset(): Date {\n    const now = new Date();\n    const tomorrow = new Date(now);\n    tomorrow.setUTCHours(24, 0, 0, 0);\n    return tomorrow;\n  }\n\n  /**\n   * Check if budget needs to be reset (past midnight UTC)\n   */\n  private checkAndReset(): void {\n    const now = new Date();\n    if (now >= this.resetAt) {\n      this.used = 0;\n      this.resetAt = this.calculateNextReset();\n      this.alertManager.reset();\n    }\n  }\n\n  /**\n   * Check if a given cost would exceed the budget\n   * Throws BudgetExceededError if it would exceed\n   *\n   * @param cost - The cost to check\n   * @throws {BudgetExceededError} If adding this cost would exceed the daily limit\n   */\n  checkBudget(cost: number): void {\n    this.checkAndReset();\n\n    // If daily limit is 0, budget is unlimited\n    if (this.dailyLimit === 0) {\n      return;\n    }\n\n    const potentialTotal = this.used + cost;\n\n    if (potentialTotal > this.dailyLimit) {\n      // BudgetExceededError expects (used, limit) not (limit, used)\n      throw new BudgetExceededError(potentialTotal, this.dailyLimit);\n    }\n  }\n\n  /**\n   * Record spending after a successful completion\n   *\n   * @param cost - The cost to add to the daily total\n   */\n  recordSpending(cost: number): void {\n    this.checkAndReset();\n    this.used += cost;\n\n    // Check budget thresholds and trigger alerts if needed\n    this.alertManager.checkBudget(this.dailyLimit, this.used, this.resetAt);\n  }\n\n  /**\n   * Get current budget status\n   */\n  getStatus(): BudgetStatus {\n    this.checkAndReset();\n\n    return {\n      dailyLimit: this.dailyLimit,\n      used: this.used,\n      remaining: this.dailyLimit === 0 ? 0 : this.dailyLimit - this.used,\n      resetAt: this.resetAt,\n    };\n  }\n\n  /**\n   * Get the daily limit\n   */\n  getDailyLimit(): number {\n    return this.dailyLimit;\n  }\n\n  /**\n   * Get current usage\n   */\n  getUsed(): number {\n    this.checkAndReset();\n    return this.used;\n  }\n\n  /**\n   * Get the alert manager instance\n   */\n  getAlertManager(): AlertManager {\n    return this.alertManager;\n  }\n}\n","import { createHash } from 'crypto';\nimport type { CompletionResult } from '../utils/types.js';\n\n/**\n * Cache entry with metadata\n */\ninterface CacheEntry {\n  prompt: string; // Original prompt for semantic matching\n  options?: any; // Original options for exact matching\n  result: CompletionResult;\n  timestamp: number;\n  accessCount: number;\n  lastAccessed: number;\n}\n\n/**\n * Cache configuration options\n */\nexport interface CacheConfig {\n  /**\n   * Maximum number of entries in cache\n   * @default 100\n   */\n  maxSize?: number;\n\n  /**\n   * Time-to-live in seconds (how long entries stay in cache)\n   * @default 3600 (1 hour)\n   */\n  ttl?: number;\n\n  /**\n   * Enable cache (can be disabled globally)\n   * @default true\n   */\n  enabled?: boolean;\n\n  /**\n   * Enable semantic caching for similar prompts\n   * @default false\n   */\n  semanticCaching?: boolean;\n\n  /**\n   * Similarity threshold for semantic matching (0-1)\n   * @default 0.9\n   */\n  similarityThreshold?: number;\n}\n\n/**\n * LRU Cache Manager for AI completions\n *\n * Implements Least Recently Used (LRU) eviction policy\n * with TTL (time-to-live) support\n */\nexport class CacheManager {\n  private cache: Map<string, CacheEntry> = new Map();\n  private config: Required<CacheConfig>;\n\n  constructor(config: CacheConfig = {}) {\n    this.config = {\n      maxSize: config.maxSize ?? 100,\n      ttl: config.ttl ?? 3600, // 1 hour default\n      enabled: config.enabled ?? true,\n      semanticCaching: config.semanticCaching ?? false,\n      similarityThreshold: config.similarityThreshold ?? 0.9,\n    };\n  }\n\n  /**\n   * Generate cache key from prompt and options\n   */\n  private generateKey(prompt: string, options?: any): string {\n    const data = JSON.stringify({ prompt, options });\n    return createHash('sha256').update(data).digest('hex');\n  }\n\n  /**\n   * Check if entry is expired\n   */\n  private isExpired(entry: CacheEntry): boolean {\n    const now = Date.now();\n    const age = (now - entry.timestamp) / 1000; // Convert to seconds\n    return age > this.config.ttl;\n  }\n\n  /**\n   * Calculate cosine similarity between two prompts\n   * Returns a value between 0 (completely different) and 1 (identical)\n   */\n  private calculateSimilarity(prompt1: string, prompt2: string): number {\n    // Normalize prompts (lowercase, trim)\n    const p1 = prompt1.toLowerCase().trim();\n    const p2 = prompt2.toLowerCase().trim();\n\n    // Exact match after normalization\n    if (p1 === p2) {\n      return 1.0;\n    }\n\n    // Tokenize into words\n    const words1 = p1.split(/\\s+/);\n    const words2 = p2.split(/\\s+/);\n\n    // Build vocabulary (unique words from both prompts)\n    const vocabulary = new Set([...words1, ...words2]);\n\n    // Create word frequency vectors\n    const vector1 = new Map<string, number>();\n    const vector2 = new Map<string, number>();\n\n    for (const word of words1) {\n      vector1.set(word, (vector1.get(word) || 0) + 1);\n    }\n\n    for (const word of words2) {\n      vector2.set(word, (vector2.get(word) || 0) + 1);\n    }\n\n    // Calculate cosine similarity\n    let dotProduct = 0;\n    let magnitude1 = 0;\n    let magnitude2 = 0;\n\n    for (const word of vocabulary) {\n      const freq1 = vector1.get(word) || 0;\n      const freq2 = vector2.get(word) || 0;\n\n      dotProduct += freq1 * freq2;\n      magnitude1 += freq1 * freq1;\n      magnitude2 += freq2 * freq2;\n    }\n\n    magnitude1 = Math.sqrt(magnitude1);\n    magnitude2 = Math.sqrt(magnitude2);\n\n    if (magnitude1 === 0 || magnitude2 === 0) {\n      return 0;\n    }\n\n    return dotProduct / (magnitude1 * magnitude2);\n  }\n\n  /**\n   * Evict least recently used entry\n   */\n  private evictLRU(): void {\n    let oldestKey: string | null = null;\n    let oldestAccess = Infinity;\n\n    for (const [key, entry] of this.cache.entries()) {\n      if (entry.lastAccessed < oldestAccess) {\n        oldestAccess = entry.lastAccessed;\n        oldestKey = key;\n      }\n    }\n\n    if (oldestKey) {\n      this.cache.delete(oldestKey);\n    }\n  }\n\n  /**\n   * Get cached result if available\n   *\n   * @param prompt - The prompt text\n   * @param options - Optional completion options\n   * @returns Cached result or null if not found/expired\n   */\n  get(prompt: string, options?: any): CompletionResult | null {\n    if (!this.config.enabled) {\n      return null;\n    }\n\n    // Try exact match first\n    const key = this.generateKey(prompt, options);\n    let entry = this.cache.get(key);\n\n    // If not found and semantic caching is enabled, try similarity search\n    if (!entry && this.config.semanticCaching) {\n      let bestMatch: CacheEntry | null = null;\n      let bestSimilarity = 0;\n\n      for (const [, cachedEntry] of this.cache.entries()) {\n        // Skip expired entries\n        if (this.isExpired(cachedEntry)) {\n          continue;\n        }\n\n        // Options must match exactly for semantic caching\n        const optionsMatch = JSON.stringify(cachedEntry.options) === JSON.stringify(options);\n        if (!optionsMatch) {\n          continue;\n        }\n\n        // Calculate similarity\n        const similarity = this.calculateSimilarity(prompt, cachedEntry.prompt);\n\n        if (similarity >= this.config.similarityThreshold && similarity > bestSimilarity) {\n          bestSimilarity = similarity;\n          bestMatch = cachedEntry;\n        }\n      }\n\n      entry = bestMatch;\n    }\n\n    if (!entry) {\n      return null;\n    }\n\n    // Check if expired\n    if (this.isExpired(entry)) {\n      return null;\n    }\n\n    // Update access metadata\n    entry.accessCount++;\n    entry.lastAccessed = Date.now();\n\n    // Return result with cached flag\n    return {\n      ...entry.result,\n      cached: true,\n    };\n  }\n\n  /**\n   * Store result in cache\n   *\n   * @param prompt - The prompt text\n   * @param options - Optional completion options\n   * @param result - The completion result to cache\n   */\n  set(prompt: string, options: any | undefined, result: CompletionResult): void {\n    if (!this.config.enabled) {\n      return;\n    }\n\n    // Check if cache is full\n    if (this.cache.size >= this.config.maxSize) {\n      this.evictLRU();\n    }\n\n    const key = this.generateKey(prompt, options);\n    const now = Date.now();\n\n    this.cache.set(key, {\n      prompt,\n      options,\n      result,\n      timestamp: now,\n      accessCount: 0,\n      lastAccessed: now,\n    });\n  }\n\n  /**\n   * Clear all cached entries\n   */\n  clear(): void {\n    this.cache.clear();\n  }\n\n  /**\n   * Get current cache size\n   */\n  size(): number {\n    return this.cache.size;\n  }\n\n  /**\n   * Get cache statistics\n   */\n  getStats() {\n    let totalAccesses = 0;\n    let expiredCount = 0;\n\n    for (const entry of this.cache.values()) {\n      totalAccesses += entry.accessCount;\n      if (this.isExpired(entry)) {\n        expiredCount++;\n      }\n    }\n\n    return {\n      size: this.cache.size,\n      maxSize: this.config.maxSize,\n      ttl: this.config.ttl,\n      enabled: this.config.enabled,\n      semanticCaching: this.config.semanticCaching,\n      similarityThreshold: this.config.similarityThreshold,\n      totalAccesses,\n      expiredCount,\n    };\n  }\n\n  /**\n   * Clean up expired entries\n   */\n  cleanup(): void {\n    const keysToDelete: string[] = [];\n\n    for (const [key, entry] of this.cache.entries()) {\n      if (this.isExpired(entry)) {\n        keysToDelete.push(key);\n      }\n    }\n\n    for (const key of keysToDelete) {\n      this.cache.delete(key);\n    }\n  }\n}\n","/**\n * Prompt compression utilities\n *\n * Reduces token usage while preserving semantic meaning\n */\n\nexport type CompressionLevel = 'low' | 'medium' | 'high';\n\n/**\n * Filler words that can be removed without losing meaning\n */\nconst FILLER_WORDS = [\n  'very', 'really', 'quite', 'rather', 'somewhat', 'fairly',\n  'just', 'actually', 'basically', 'literally', 'honestly',\n  'simply', 'clearly', 'obviously', 'essentially', 'particularly',\n];\n\n/**\n * Common phrase replacements for compression\n */\nconst PHRASE_REPLACEMENTS: Record<string, string> = {\n  'in order to': 'to',\n  'due to the fact that': 'because',\n  'at this point in time': 'now',\n  'for the purpose of': 'to',\n  'in the event that': 'if',\n  'a large number of': 'many',\n  'a small number of': 'few',\n  'on a regular basis': 'regularly',\n  'in spite of': 'despite',\n  'take into consideration': 'consider',\n  'make a decision': 'decide',\n  'give an answer': 'answer',\n  'have the ability to': 'can',\n  'in the near future': 'soon',\n  'at the present time': 'now',\n};\n\n/**\n * Compressor class for reducing prompt token usage\n */\nexport class Compressor {\n  /**\n   * Compress a prompt based on the specified level\n   *\n   * @param prompt - The text to compress\n   * @param level - Compression level (low, medium, high)\n   * @returns Compressed prompt\n   */\n  static compress(prompt: string, level: CompressionLevel = 'medium'): string {\n    let compressed = prompt;\n\n    // All levels: normalize whitespace\n    compressed = this.normalizeWhitespace(compressed);\n\n    if (level === 'low') {\n      return compressed;\n    }\n\n    // Medium and High: remove filler words and simplify phrases\n    compressed = this.removeFillerWords(compressed);\n    compressed = this.simplifyPhrases(compressed);\n\n    if (level === 'medium') {\n      return compressed;\n    }\n\n    // High: aggressive compression\n    compressed = this.removeArticles(compressed);\n    compressed = this.useContractions(compressed);\n    compressed = this.abbreviateCommon(compressed);\n\n    return compressed;\n  }\n\n  /**\n   * Normalize whitespace (remove extra spaces, trim)\n   */\n  private static normalizeWhitespace(text: string): string {\n    return text\n      .replace(/[^\\S\\n]+/g, ' ')      // Multiple spaces to single (but not newlines)\n      .replace(/\\n\\s*\\n+/g, '\\n')     // Multiple newlines to single newline\n      .trim();\n  }\n\n  /**\n   * Remove filler words that don't add meaning\n   */\n  private static removeFillerWords(text: string): string {\n    const fillerPattern = new RegExp(`\\\\b(${FILLER_WORDS.join('|')})\\\\b`, 'gi');\n    return text.replace(fillerPattern, '').replace(/\\s+/g, ' ').trim();\n  }\n\n  /**\n   * Simplify common verbose phrases\n   */\n  private static simplifyPhrases(text: string): string {\n    let simplified = text;\n\n    for (const [verbose, concise] of Object.entries(PHRASE_REPLACEMENTS)) {\n      const pattern = new RegExp(verbose, 'gi');\n      simplified = simplified.replace(pattern, concise);\n    }\n\n    return simplified;\n  }\n\n  /**\n   * Remove articles (a, an, the) where they're not critical\n   */\n  private static removeArticles(text: string): string {\n    // Only remove articles that are not at the start of sentences\n    // and not critical for meaning (heuristic approach)\n    return text\n      .replace(/\\s+(a|an|the)\\s+/gi, ' ')  // Remove mid-sentence articles\n      .replace(/\\s+/g, ' ')\n      .trim();\n  }\n\n  /**\n   * Use contractions to reduce token count\n   */\n  private static useContractions(text: string): string {\n    const contractions: Record<string, string> = {\n      'do not': \"don't\",\n      'does not': \"doesn't\",\n      'did not': \"didn't\",\n      'will not': \"won't\",\n      'would not': \"wouldn't\",\n      'should not': \"shouldn't\",\n      'could not': \"couldn't\",\n      'cannot': \"can't\",\n      'are not': \"aren't\",\n      'is not': \"isn't\",\n      'was not': \"wasn't\",\n      'were not': \"weren't\",\n      'have not': \"haven't\",\n      'has not': \"hasn't\",\n      'had not': \"hadn't\",\n      'I am': \"I'm\",\n      'you are': \"you're\",\n      'he is': \"he's\",\n      'she is': \"she's\",\n      'it is': \"it's\",\n      'we are': \"we're\",\n      'they are': \"they're\",\n      'I have': \"I've\",\n      'you have': \"you've\",\n      'we have': \"we've\",\n      'they have': \"they've\",\n      'I will': \"I'll\",\n      'you will': \"you'll\",\n      'he will': \"he'll\",\n      'she will': \"she'll\",\n      'we will': \"we'll\",\n      'they will': \"they'll\",\n      'I would': \"I'd\",\n      'you would': \"you'd\",\n      'he would': \"he'd\",\n      'she would': \"she'd\",\n      'we would': \"we'd\",\n      'they would': \"they'd\",\n    };\n\n    let contracted = text;\n\n    for (const [phrase, contraction] of Object.entries(contractions)) {\n      const pattern = new RegExp(`\\\\b${phrase}\\\\b`, 'gi');\n      contracted = contracted.replace(pattern, contraction);\n    }\n\n    return contracted;\n  }\n\n  /**\n   * Abbreviate common words\n   */\n  private static abbreviateCommon(text: string): string {\n    const abbreviations: Record<string, string> = {\n      'approximately': 'approx',\n      'regarding': 're',\n      'information': 'info',\n      'example': 'e.g.',\n      'because': 'bc',\n      'without': 'w/o',\n      'with': 'w/',\n      'between': 'btw',\n      'through': 'thru',\n      'number': 'no.',\n      'versus': 'vs',\n    };\n\n    let abbreviated = text;\n\n    for (const [word, abbrev] of Object.entries(abbreviations)) {\n      const pattern = new RegExp(`\\\\b${word}\\\\b`, 'gi');\n      abbreviated = abbreviated.replace(pattern, abbrev);\n    }\n\n    return abbreviated;\n  }\n\n  /**\n   * Calculate compression ratio\n   *\n   * @param original - Original text\n   * @param compressed - Compressed text\n   * @returns Compression ratio (0-1, where 0.25 means 25% reduction)\n   */\n  static getCompressionRatio(original: string, compressed: string): number {\n    const originalLength = original.length;\n    const compressedLength = compressed.length;\n\n    if (originalLength === 0) return 0;\n\n    const reduction = (originalLength - compressedLength) / originalLength;\n    return Math.max(0, Math.min(1, reduction));\n  }\n}\n","import type { AlertPayload, BudgetAlertData } from './types.js';\n\n/**\n * Slack message attachment\n */\ninterface SlackAttachment {\n  color: string;\n  title: string;\n  text?: string;\n  fields?: Array<{\n    title: string;\n    value: string;\n    short: boolean;\n  }>;\n  footer?: string;\n  ts?: number;\n}\n\n/**\n * Slack webhook payload\n */\ninterface SlackPayload {\n  text: string;\n  attachments?: SlackAttachment[];\n}\n\n/**\n * Send alert to Slack webhook\n *\n * @param webhookUrl - Slack webhook URL\n * @param payload - Alert payload\n */\nexport async function sendSlackWebhook(webhookUrl: string, payload: AlertPayload): Promise<void> {\n  const slackPayload = formatSlackMessage(payload);\n\n  const response = await fetch(webhookUrl, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify(slackPayload),\n  });\n\n  if (!response.ok) {\n    const text = await response.text();\n    throw new Error(`Slack webhook failed: ${response.status} ${text}`);\n  }\n}\n\n/**\n * Format alert as Slack message\n *\n * @param payload - Alert payload\n * @returns Slack-formatted message\n */\nfunction formatSlackMessage(payload: AlertPayload): SlackPayload {\n  const { event, severity, data } = payload;\n\n  // Determine color based on severity\n  const colors: Record<string, string> = {\n    info: '#36a64f',      // Green\n    warning: '#ffcc00',   // Yellow\n    urgent: '#ff9900',    // Orange\n    critical: '#ff0000',  // Red\n  };\n\n  const color: string = colors[severity] ?? '#36a64f';\n\n  // Format based on event type\n  if (event === 'budget_warning' || event === 'budget_urgent' || event === 'budget_exceeded') {\n    const budgetData = data as BudgetAlertData;\n    return formatBudgetAlert(event, color, budgetData);\n  }\n\n  // Default generic alert\n  return {\n    text: `Cognigate Alert: ${event}`,\n    attachments: [{\n      color,\n      title: `Alert: ${event}`,\n      text: JSON.stringify(data, null, 2),\n      footer: 'Cognigate',\n      ts: Math.floor(Date.now() / 1000),\n    }],\n  };\n}\n\n/**\n * Format budget alert for Slack\n */\nfunction formatBudgetAlert(\n  event: string,\n  color: string,\n  data: BudgetAlertData\n): SlackPayload {\n  const titles: Record<string, string> = {\n    budget_warning: ' Budget Warning: 50% Used',\n    budget_urgent: ' Budget Alert: 80% Used',\n    budget_exceeded: ' Budget Exceeded!',\n  };\n\n  const title = titles[event] || 'Budget Alert';\n\n  return {\n    text: title,\n    attachments: [{\n      color,\n      title,\n      fields: [\n        {\n          title: 'Daily Limit',\n          value: `$${data.dailyLimit.toFixed(2)}`,\n          short: true,\n        },\n        {\n          title: 'Used',\n          value: `$${data.used.toFixed(2)} (${data.percentage.toFixed(1)}%)`,\n          short: true,\n        },\n        {\n          title: 'Remaining',\n          value: `$${data.remaining.toFixed(2)}`,\n          short: true,\n        },\n        {\n          title: 'Resets At',\n          value: new Date(data.resetAt).toLocaleString(),\n          short: true,\n        },\n      ],\n      footer: 'Cognigate Budget Monitor',\n      ts: Math.floor(Date.now() / 1000),\n    }],\n  };\n}\n","import type { AlertPayload, BudgetAlertData } from './types.js';\n\n/**\n * Discord embed field\n */\ninterface DiscordEmbedField {\n  name: string;\n  value: string;\n  inline?: boolean;\n}\n\n/**\n * Discord embed\n */\ninterface DiscordEmbed {\n  title: string;\n  description?: string;\n  color: number;\n  fields?: DiscordEmbedField[];\n  footer?: {\n    text: string;\n  };\n  timestamp?: string;\n}\n\n/**\n * Discord webhook payload\n */\ninterface DiscordPayload {\n  content?: string;\n  embeds: DiscordEmbed[];\n}\n\n/**\n * Send alert to Discord webhook\n *\n * @param webhookUrl - Discord webhook URL\n * @param payload - Alert payload\n */\nexport async function sendDiscordWebhook(webhookUrl: string, payload: AlertPayload): Promise<void> {\n  const discordPayload = formatDiscordMessage(payload);\n\n  const response = await fetch(webhookUrl, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify(discordPayload),\n  });\n\n  if (!response.ok) {\n    const text = await response.text();\n    throw new Error(`Discord webhook failed: ${response.status} ${text}`);\n  }\n}\n\n/**\n * Format alert as Discord message\n *\n * @param payload - Alert payload\n * @returns Discord-formatted message\n */\nfunction formatDiscordMessage(payload: AlertPayload): DiscordPayload {\n  const { event, severity, data } = payload;\n\n  // Determine color based on severity\n  const colors: Record<string, number> = {\n    info: 0x36a64f,      // Green\n    warning: 0xffcc00,   // Yellow\n    urgent: 0xff9900,    // Orange\n    critical: 0xff0000,  // Red\n  };\n\n  const color: number = colors[severity] ?? 0x36a64f;\n\n  // Format based on event type\n  if (event === 'budget_warning' || event === 'budget_urgent' || event === 'budget_exceeded') {\n    const budgetData = data as BudgetAlertData;\n    return formatBudgetAlert(event, color, budgetData);\n  }\n\n  // Default generic alert\n  return {\n    embeds: [{\n      title: `Cognigate Alert: ${event}`,\n      description: JSON.stringify(data, null, 2),\n      color,\n      footer: {\n        text: 'Cognigate',\n      },\n      timestamp: new Date().toISOString(),\n    }],\n  };\n}\n\n/**\n * Format budget alert for Discord\n */\nfunction formatBudgetAlert(\n  event: string,\n  color: number,\n  data: BudgetAlertData\n): DiscordPayload {\n  const titles: Record<string, string> = {\n    budget_warning: ' Budget Warning: 50% Used',\n    budget_urgent: ' Budget Alert: 80% Used',\n    budget_exceeded: ' Budget Exceeded!',\n  };\n\n  const title = titles[event] || 'Budget Alert';\n\n  return {\n    content: title,\n    embeds: [{\n      title,\n      color,\n      fields: [\n        {\n          name: 'Daily Limit',\n          value: `$${data.dailyLimit.toFixed(2)}`,\n          inline: true,\n        },\n        {\n          name: 'Used',\n          value: `$${data.used.toFixed(2)} (${data.percentage.toFixed(1)}%)`,\n          inline: true,\n        },\n        {\n          name: 'Remaining',\n          value: `$${data.remaining.toFixed(2)}`,\n          inline: true,\n        },\n        {\n          name: 'Resets At',\n          value: new Date(data.resetAt).toLocaleString(),\n          inline: false,\n        },\n      ],\n      footer: {\n        text: 'Cognigate Budget Monitor',\n      },\n      timestamp: new Date().toISOString(),\n    }],\n  };\n}\n","import type { WebhooksConfig } from '../utils/types.js';\nimport type { AlertPayload, WebhookResult } from './types.js';\nimport { sendSlackWebhook } from './slack.js';\nimport { sendDiscordWebhook } from './discord.js';\n\n/**\n * Webhook manager for sending alerts to multiple platforms\n *\n * Orchestrates webhook delivery to Slack, Discord, and custom webhooks.\n * Handles failures gracefully without crashing the application.\n */\nexport class WebhookManager {\n  private config: WebhooksConfig;\n\n  constructor(config: WebhooksConfig = {}) {\n    this.config = config;\n  }\n\n  /**\n   * Send alert to all configured webhooks\n   *\n   * @param payload - Alert payload\n   * @returns Array of webhook results\n   */\n  async sendAlert(payload: AlertPayload): Promise<WebhookResult[]> {\n    const results: WebhookResult[] = [];\n\n    // Send to Slack if configured\n    if (this.config.slack) {\n      try {\n        await sendSlackWebhook(this.config.slack, payload);\n        results.push({\n          success: true,\n          webhook: 'slack',\n        });\n      } catch (error) {\n        results.push({\n          success: false,\n          webhook: 'slack',\n          error: error instanceof Error ? error.message : 'Unknown error',\n        });\n      }\n    }\n\n    // Send to Discord if configured\n    if (this.config.discord) {\n      try {\n        await sendDiscordWebhook(this.config.discord, payload);\n        results.push({\n          success: true,\n          webhook: 'discord',\n        });\n      } catch (error) {\n        results.push({\n          success: false,\n          webhook: 'discord',\n          error: error instanceof Error ? error.message : 'Unknown error',\n        });\n      }\n    }\n\n    // Send to custom webhook if configured\n    if (this.config.custom) {\n      try {\n        await this.sendCustomWebhook(this.config.custom, payload);\n        results.push({\n          success: true,\n          webhook: 'custom',\n        });\n      } catch (error) {\n        results.push({\n          success: false,\n          webhook: 'custom',\n          error: error instanceof Error ? error.message : 'Unknown error',\n        });\n      }\n    }\n\n    return results;\n  }\n\n  /**\n   * Send alert to custom webhook URL\n   *\n   * @param url - Webhook URL\n   * @param payload - Alert payload\n   */\n  private async sendCustomWebhook(url: string, payload: AlertPayload): Promise<void> {\n    const response = await fetch(url, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify(payload),\n    });\n\n    if (!response.ok) {\n      throw new Error(`Webhook failed: ${response.status} ${response.statusText}`);\n    }\n  }\n\n  /**\n   * Update webhook configuration\n   *\n   * @param config - New webhook configuration\n   */\n  updateConfig(config: WebhooksConfig): void {\n    this.config = config;\n  }\n\n  /**\n   * Get current configuration\n   */\n  getConfig(): Readonly<WebhooksConfig> {\n    return { ...this.config };\n  }\n}\n","import type {\n  GatewayConfig,\n  CompletionOptions,\n  BudgetStatus,\n  Provider,\n} from '../utils/types.js';\nimport { ConfigurationError, ProviderUnavailableError } from '../utils/errors.js';\nimport { OpenAIProvider } from '../providers/cloud/openai.js';\nimport { AnthropicProvider } from '../providers/cloud/anthropic.js';\nimport { GoogleProvider } from '../providers/cloud/google.js';\nimport { OllamaProvider } from '../providers/local/ollama.js';\nimport { LMStudioProvider } from '../providers/local/lmstudio.js';\nimport { WebLLMProvider } from '../providers/local/webllm.js';\nimport { BudgetManager } from './budget-manager.js';\nimport { CacheManager } from './cache-manager.js';\nimport { Compressor } from './compressor.js';\nimport { AlertManager } from './alert-manager.js';\nimport { WebhookManager } from '../webhooks/webhook-manager.js';\nimport type { AlertPayload } from '../webhooks/types.js';\n\n/**\n * Main Gateway class for Cognigate\n *\n * Handles AI completions with budget controls, caching, and provider management.\n */\nexport class Gateway {\n  private config: Required<GatewayConfig>;\n  private providers: Provider[] = [];\n  private budgetManager: BudgetManager;\n  private cacheManager: CacheManager;\n  private alertManager: AlertManager;\n  private webhookManager: WebhookManager;\n\n  constructor(config: GatewayConfig = {}) {\n    // Validate and set defaults\n    this.config = this.validateAndSetDefaults(config);\n\n    // Initialize alert manager\n    this.alertManager = new AlertManager();\n\n    // Initialize budget manager with alert manager\n    this.budgetManager = new BudgetManager(this.config.dailyBudget, this.alertManager);\n\n    // Initialize cache manager\n    this.cacheManager = new CacheManager({\n      enabled: this.config.cacheEnabled,\n      semanticCaching: this.config.semanticCaching,\n      similarityThreshold: this.config.similarityThreshold,\n    });\n\n    // Initialize webhook manager\n    this.webhookManager = new WebhookManager(this.config.webhooks);\n\n    // Connect alert manager to webhook manager\n    this.alertManager.on('alert', (payload: AlertPayload) => {\n      this.webhookManager.sendAlert(payload).catch(error => {\n        console.error('Failed to send webhook alert:', error);\n      });\n    });\n\n    // Initialize providers\n    this.initializeProviders();\n  }\n\n  /**\n   * Initialize providers based on configuration\n   */\n  private initializeProviders(): void {\n    // Initialize cloud providers\n    if (this.config.cloudProviders.openai) {\n      this.providers.push(new OpenAIProvider(this.config.cloudProviders.openai));\n    }\n\n    if (this.config.cloudProviders.anthropic) {\n      this.providers.push(new AnthropicProvider(this.config.cloudProviders.anthropic));\n    }\n\n    if (this.config.cloudProviders.google) {\n      this.providers.push(new GoogleProvider(this.config.cloudProviders.google));\n    }\n\n    // Initialize local fallback providers\n    if (this.config.localFallback.enabled) {\n      const localProviders = this.config.localFallback.providers || ['ollama', 'lmstudio', 'webllm'];\n\n      for (const providerName of localProviders) {\n        if (providerName === 'ollama') {\n          this.providers.push(new OllamaProvider());\n        } else if (providerName === 'lmstudio') {\n          this.providers.push(new LMStudioProvider());\n        } else if (providerName === 'webllm') {\n          this.providers.push(new WebLLMProvider());\n        }\n      }\n    }\n  }\n\n  /**\n   * Validates configuration and applies defaults\n   */\n  private validateAndSetDefaults(config: GatewayConfig): Required<GatewayConfig> {\n    // Check if any providers are configured\n    const hasCloudProvider = config.cloudProviders && Object.keys(config.cloudProviders).length > 0;\n    const localFallbackExplicitlyDisabled = config.localFallback?.enabled === false;\n\n    // Default to local fallback if no cloud providers configured and not explicitly disabled\n    const defaultLocalFallback = !hasCloudProvider && !localFallbackExplicitlyDisabled;\n\n    // Set defaults\n    const validated: Required<GatewayConfig> = {\n      dailyBudget: config.dailyBudget ?? 0,\n      cacheEnabled: config.cacheEnabled ?? true,\n      semanticCaching: config.semanticCaching ?? false,\n      similarityThreshold: config.similarityThreshold ?? 0.9,\n      compressionLevel: config.compressionLevel ?? 'medium',\n      localFallback: config.localFallback ?? {\n        enabled: defaultLocalFallback,\n        providers: ['ollama', 'lmstudio', 'webllm']\n      },\n      cloudProviders: config.cloudProviders ?? {},\n      webhooks: config.webhooks ?? {},\n    };\n\n    // Validate dailyBudget\n    if (validated.dailyBudget < 0) {\n      throw new ConfigurationError('dailyBudget must be >= 0 (0 = unlimited)');\n    }\n\n    // Validate compression level\n    const validCompressionLevels = ['low', 'medium', 'high'];\n    if (!validCompressionLevels.includes(validated.compressionLevel)) {\n      throw new ConfigurationError(\n        `compressionLevel must be one of: ${validCompressionLevels.join(', ')}`\n      );\n    }\n\n    // Validate similarity threshold\n    if (validated.similarityThreshold < 0 || validated.similarityThreshold > 1) {\n      throw new ConfigurationError(\n        'similarityThreshold must be between 0 and 1'\n      );\n    }\n\n    // Validate that at least one provider is configured or will be available\n    const hasAnyProvider = Object.keys(validated.cloudProviders).length > 0 || validated.localFallback.enabled;\n\n    if (!hasAnyProvider) {\n      throw new ConfigurationError(\n        'At least one cloud provider or local fallback must be enabled'\n      );\n    }\n\n    return validated;\n  }\n\n  /**\n   * Complete a prompt and return the response\n   *\n   * @param prompt - The text prompt to complete\n   * @param options - Optional completion options\n   * @returns The completion response text\n   * @throws {BudgetExceededError} If the request would exceed the daily budget\n   * @throws {ProviderUnavailableError} If all providers fail\n   */\n  async complete(prompt: string, options?: CompletionOptions): Promise<string> {\n    // Check cache first (using original prompt)\n    const cachedResult = this.cacheManager.get(prompt, options);\n    if (cachedResult) {\n      return cachedResult.text;\n    }\n\n    // Apply compression to reduce token usage\n    const compressedPrompt = Compressor.compress(prompt, this.config.compressionLevel);\n\n    // Get candidate providers\n    let candidateProviders = this.providers;\n\n    if (options?.forceProvider) {\n      candidateProviders = this.providers.filter(p => p.type === options.forceProvider);\n    }\n\n    if (candidateProviders.length === 0) {\n      throw new ProviderUnavailableError(\n        'all',\n        'No providers configured. Add at least one cloud provider or enable local fallback.'\n      );\n    }\n\n    const errors: Array<{ provider: string; error: string }> = [];\n\n    // Try each provider in order until one succeeds\n    for (const provider of candidateProviders) {\n      // Check if provider is available\n      if (!await provider.isAvailable()) {\n        errors.push({\n          provider: provider.name,\n          error: 'Provider not available (check API key or service status)'\n        });\n        continue;\n      }\n\n      try {\n        // Estimate cost before making the request (using compressed prompt)\n        const estimatedCost = provider.estimateCost(compressedPrompt);\n\n        // Check if this request would exceed budget\n        this.budgetManager.checkBudget(estimatedCost);\n\n        // Complete the request using the provider (with compressed prompt)\n        const result = await provider.complete(compressedPrompt, options);\n\n        // Record actual spending\n        this.budgetManager.recordSpending(result.cost);\n\n        // Cache the result for future requests (keyed by original prompt)\n        this.cacheManager.set(prompt, options, result);\n\n        return result.text;\n\n      } catch (error) {\n        // If it's a budget error, don't try other providers - just throw\n        if (error instanceof Error && error.name === 'BudgetExceededError') {\n          throw error;\n        }\n\n        // Record the error and try next provider\n        errors.push({\n          provider: provider.name,\n          error: error instanceof Error ? error.message : 'Unknown error'\n        });\n        continue;\n      }\n    }\n\n    // All providers failed - throw detailed error\n    const errorDetails = errors.map(e => `${e.provider}: ${e.error}`).join('; ');\n    throw new ProviderUnavailableError(\n      'all',\n      `All providers failed. Errors: ${errorDetails}`\n    );\n  }\n\n  /**\n   * Stream a completion response token-by-token\n   *\n   * @param prompt - The text prompt to complete\n   * @param options - Optional completion options\n   * @returns Async iterator yielding response tokens\n   * @throws {BudgetExceededError} If the request would exceed the daily budget\n   * @throws {ProviderUnavailableError} If all providers fail\n   *\n   * @example\n   * ```typescript\n   * for await (const token of ai.stream('Write a story')) {\n   *   process.stdout.write(token);\n   * }\n   * ```\n   */\n  async *stream(prompt: string, options?: CompletionOptions): AsyncIterable<string> {\n    // Apply compression to reduce token usage\n    const compressedPrompt = Compressor.compress(prompt, this.config.compressionLevel);\n\n    // Get candidate providers\n    let candidateProviders = this.providers;\n\n    if (options?.forceProvider) {\n      candidateProviders = this.providers.filter(p => p.type === options.forceProvider);\n    }\n\n    if (candidateProviders.length === 0) {\n      throw new ProviderUnavailableError(\n        'all',\n        'No providers configured. Add at least one cloud provider or enable local fallback.'\n      );\n    }\n\n    const errors: Array<{ provider: string; error: string }> = [];\n\n    // Try each provider in order until one succeeds\n    for (const provider of candidateProviders) {\n      // Check if provider is available\n      if (!await provider.isAvailable()) {\n        errors.push({\n          provider: provider.name,\n          error: 'Provider not available (check API key or service status)'\n        });\n        continue;\n      }\n\n      try {\n        // Estimate cost before making the request (using compressed prompt)\n        const estimatedCost = provider.estimateCost(compressedPrompt);\n\n        // Check if this request would exceed budget\n        this.budgetManager.checkBudget(estimatedCost);\n\n        // Stream the response using the provider (with compressed prompt)\n        let fullText = '';\n        for await (const token of provider.stream(compressedPrompt, options)) {\n          fullText += token;\n          yield token;\n        }\n\n        // Record spending after streaming completes\n        // Note: We use the same cost estimation since streaming doesn't return cost metadata\n        this.budgetManager.recordSpending(estimatedCost);\n\n        // Successfully streamed - exit\n        return;\n\n      } catch (error) {\n        // If it's a budget error, don't try other providers - just throw\n        if (error instanceof Error && error.name === 'BudgetExceededError') {\n          throw error;\n        }\n\n        // Record the error and try next provider\n        errors.push({\n          provider: provider.name,\n          error: error instanceof Error ? error.message : 'Unknown error'\n        });\n        continue;\n      }\n    }\n\n    // All providers failed - throw detailed error\n    const errorDetails = errors.map(e => `${e.provider}: ${e.error}`).join('; ');\n    throw new ProviderUnavailableError(\n      'all',\n      `All providers failed. Errors: ${errorDetails}`\n    );\n  }\n\n  /**\n   * Get current budget status\n   *\n   * @returns Budget status including used, remaining, and reset time\n   */\n  getBudgetStatus(): BudgetStatus {\n    return this.budgetManager.getStatus();\n  }\n\n  /**\n   * Clear the cache manually\n   */\n  clearCache(): void {\n    this.cacheManager.clear();\n  }\n\n  /**\n   * Get the current configuration\n   * (Useful for debugging)\n   */\n  getConfig(): Readonly<Required<GatewayConfig>> {\n    return { ...this.config };\n  }\n}\n","/**\n * Voice recognition configuration\n */\nexport interface RecognizerConfig {\n  /**\n   * Language code for speech recognition\n   * @default browser default\n   * @example 'en-US', 'es-ES', 'fr-FR'\n   */\n  language?: string;\n\n  /**\n   * Continuous recognition mode\n   * When true, keeps listening until explicitly stopped\n   * @default false\n   */\n  continuous?: boolean;\n\n  /**\n   * Return interim results while still speaking\n   * @default false\n   */\n  interimResults?: boolean;\n\n  /**\n   * Maximum number of alternative transcriptions\n   * @default 1\n   */\n  maxAlternatives?: number;\n}\n\n/**\n * Speech recognition result\n */\nexport interface RecognitionResult {\n  /**\n   * Transcribed text\n   */\n  transcript: string;\n\n  /**\n   * Confidence score (0-1)\n   */\n  confidence: number;\n\n  /**\n   * Whether this is a final result or interim\n   */\n  isFinal: boolean;\n}\n\n/**\n * Text-to-speech configuration\n */\nexport interface SpeakerConfig {\n  /**\n   * Voice name to use for TTS\n   * @default browser default voice\n   */\n  voiceName?: string;\n\n  /**\n   * Language code for TTS\n   * @default 'en-US'\n   */\n  language?: string;\n\n  /**\n   * Speech rate (0.1 to 10)\n   * @default 1\n   */\n  rate?: number;\n\n  /**\n   * Speech pitch (0 to 2)\n   * @default 1\n   */\n  pitch?: number;\n\n  /**\n   * Speech volume (0 to 1)\n   * @default 1\n   */\n  volume?: number;\n}\n\n/**\n * Conversation configuration\n */\nexport interface ConversationConfig {\n  /**\n   * Enable continuous conversation loop\n   * When true, automatically resumes listening after AI responds\n   * @default false\n   */\n  continuous?: boolean;\n\n  /**\n   * Automatically speak AI responses\n   * @default true\n   */\n  autoSpeak?: boolean;\n\n  /**\n   * Speech recognition configuration\n   */\n  recognizer?: RecognizerConfig;\n\n  /**\n   * Text-to-speech configuration\n   */\n  speaker?: SpeakerConfig;\n}\n\n/**\n * Voice errors\n */\nexport class VoiceError extends Error {\n  constructor(message: string) {\n    super(message);\n    this.name = 'VoiceError';\n  }\n}\n\nexport class VoiceNotSupportedError extends VoiceError {\n  constructor(feature: string) {\n    super(`${feature} is not supported in this browser`);\n    this.name = 'VoiceNotSupportedError';\n  }\n}\n\nexport class VoicePermissionError extends VoiceError {\n  constructor() {\n    super('Microphone permission denied');\n    this.name = 'VoicePermissionError';\n  }\n}\n","import type { RecognizerConfig, RecognitionResult } from './types.js';\nimport { VoiceNotSupportedError, VoicePermissionError } from './types.js';\n\n/**\n * Speech recognition wrapper using Web Speech API\n *\n * Provides a clean interface for browser-based speech recognition\n * with cross-browser support and error handling.\n *\n * @example\n * ```typescript\n * const recognizer = new SpeechRecognizer({\n *   language: 'en-US',\n *   continuous: false\n * });\n *\n * recognizer.on('result', (result) => {\n *   console.log('You said:', result.transcript);\n * });\n *\n * await recognizer.startListening();\n * ```\n */\nexport class SpeechRecognizer {\n  private recognition: any; // SpeechRecognition type not available in Node\n  private config: Required<RecognizerConfig>;\n  private listeners: Map<string, Set<Function>> = new Map();\n  private isListening = false;\n\n  constructor(config: RecognizerConfig = {}) {\n    this.config = {\n      language: config.language || '',\n      continuous: config.continuous ?? false,\n      interimResults: config.interimResults ?? false,\n      maxAlternatives: config.maxAlternatives ?? 1,\n    };\n\n    // Check browser support\n    if (!this.isSupported()) {\n      throw new VoiceNotSupportedError('Speech Recognition');\n    }\n\n    this.initializeRecognition();\n  }\n\n  /**\n   * Check if speech recognition is supported\n   */\n  static isSupported(): boolean {\n    if (typeof window === 'undefined') {\n      return false;\n    }\n\n    return 'SpeechRecognition' in window || 'webkitSpeechRecognition' in window;\n  }\n\n  /**\n   * Check if speech recognition is supported (instance method)\n   */\n  private isSupported(): boolean {\n    return SpeechRecognizer.isSupported();\n  }\n\n  /**\n   * Initialize speech recognition\n   */\n  private initializeRecognition(): void {\n    // @ts-ignore - SpeechRecognition types not available\n    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\n    this.recognition = new SpeechRecognition();\n\n    // Configure recognition\n    if (this.config.language) {\n      this.recognition.lang = this.config.language;\n    }\n    this.recognition.continuous = this.config.continuous;\n    this.recognition.interimResults = this.config.interimResults;\n    this.recognition.maxAlternatives = this.config.maxAlternatives;\n\n    // Set up event handlers\n    this.recognition.onresult = (event: any) => {\n      const results = event.results;\n      const lastResult = results[results.length - 1];\n      const alternative = lastResult[0];\n\n      const result: RecognitionResult = {\n        transcript: alternative.transcript,\n        confidence: alternative.confidence,\n        isFinal: lastResult.isFinal,\n      };\n\n      this.emit('result', result);\n    };\n\n    this.recognition.onerror = (event: any) => {\n      const error = event.error;\n\n      if (error === 'not-allowed' || error === 'permission-denied') {\n        this.emit('error', new VoicePermissionError());\n      } else {\n        this.emit('error', new Error(`Speech recognition error: ${error}`));\n      }\n\n      this.isListening = false;\n    };\n\n    this.recognition.onend = () => {\n      this.isListening = false;\n      this.emit('end');\n    };\n\n    this.recognition.onstart = () => {\n      this.isListening = true;\n      this.emit('start');\n    };\n  }\n\n  /**\n   * Start listening for speech\n   *\n   * @throws {VoicePermissionError} If microphone permission is denied\n   */\n  async startListening(): Promise<void> {\n    if (this.isListening) {\n      return;\n    }\n\n    try {\n      this.recognition.start();\n    } catch (error) {\n      if (error instanceof Error && error.message.includes('already started')) {\n        // Already listening, ignore\n        return;\n      }\n      throw error;\n    }\n  }\n\n  /**\n   * Stop listening for speech\n   */\n  stopListening(): void {\n    if (!this.isListening) {\n      return;\n    }\n\n    this.recognition.stop();\n  }\n\n  /**\n   * Abort listening immediately\n   */\n  abort(): void {\n    this.recognition.abort();\n    this.isListening = false;\n  }\n\n  /**\n   * Check if currently listening\n   */\n  isActive(): boolean {\n    return this.isListening;\n  }\n\n  /**\n   * Register event listener\n   *\n   * Events:\n   * - 'result': Fired when speech is recognized\n   * - 'error': Fired when an error occurs\n   * - 'start': Fired when recognition starts\n   * - 'end': Fired when recognition ends\n   *\n   * @param event - Event name\n   * @param callback - Event callback\n   */\n  on(event: string, callback: Function): void {\n    if (!this.listeners.has(event)) {\n      this.listeners.set(event, new Set());\n    }\n\n    this.listeners.get(event)!.add(callback);\n  }\n\n  /**\n   * Remove event listener\n   *\n   * @param event - Event name\n   * @param callback - Event callback\n   */\n  off(event: string, callback: Function): void {\n    const callbacks = this.listeners.get(event);\n    if (callbacks) {\n      callbacks.delete(callback);\n    }\n  }\n\n  /**\n   * Emit event to all listeners\n   *\n   * @param event - Event name\n   * @param data - Event data\n   */\n  private emit(event: string, data?: any): void {\n    const callbacks = this.listeners.get(event);\n    if (callbacks) {\n      callbacks.forEach(callback => callback(data));\n    }\n  }\n\n  /**\n   * Get current configuration\n   */\n  getConfig(): Readonly<Required<RecognizerConfig>> {\n    return { ...this.config };\n  }\n}\n","import type { SpeakerConfig } from './types.js';\nimport { VoiceNotSupportedError } from './types.js';\n\n/**\n * Text-to-speech wrapper using Web Speech API\n *\n * Provides a clean interface for browser-based text-to-speech\n * with voice selection, queuing, and interruption handling.\n *\n * @example\n * ```typescript\n * const speaker = new Speaker({\n *   language: 'en-US',\n *   rate: 1.0,\n *   pitch: 1.0\n * });\n *\n * speaker.speak('Hello, world!');\n * speaker.on('end', () => console.log('Finished speaking'));\n * ```\n */\nexport class Speaker {\n  private config: Required<SpeakerConfig>;\n  private synthesis: SpeechSynthesis;\n  private listeners: Map<string, Set<Function>> = new Map();\n  private queue: SpeechSynthesisUtterance[] = [];\n  private isSpeaking = false;\n\n  constructor(config: SpeakerConfig = {}) {\n    this.config = {\n      voiceName: config.voiceName || '',\n      language: config.language || 'en-US',\n      rate: config.rate ?? 1,\n      pitch: config.pitch ?? 1,\n      volume: config.volume ?? 1,\n    };\n\n    // Check browser support\n    if (!this.isSupported()) {\n      throw new VoiceNotSupportedError('Speech Synthesis');\n    }\n\n    this.synthesis = window.speechSynthesis;\n  }\n\n  /**\n   * Check if text-to-speech is supported\n   */\n  static isSupported(): boolean {\n    if (typeof window === 'undefined') {\n      return false;\n    }\n\n    return 'speechSynthesis' in window;\n  }\n\n  /**\n   * Check if text-to-speech is supported (instance method)\n   */\n  private isSupported(): boolean {\n    return Speaker.isSupported();\n  }\n\n  /**\n   * Speak text aloud\n   *\n   * @param text - Text to speak\n   * @param options - Optional override config for this utterance\n   */\n  speak(text: string, options?: Partial<SpeakerConfig>): void {\n    const utterance = new SpeechSynthesisUtterance(text);\n\n    // Apply configuration\n    const config = { ...this.config, ...options };\n\n    utterance.lang = config.language;\n    utterance.rate = config.rate;\n    utterance.pitch = config.pitch;\n    utterance.volume = config.volume;\n\n    // Set voice if specified\n    if (config.voiceName) {\n      const voices = this.getVoices();\n      const voice = voices.find(v => v.name === config.voiceName);\n      if (voice) {\n        utterance.voice = voice;\n      }\n    }\n\n    // Set up event handlers\n    utterance.onstart = () => {\n      this.isSpeaking = true;\n      this.emit('start');\n    };\n\n    utterance.onend = () => {\n      this.isSpeaking = false;\n      this.emit('end');\n\n      // Process next in queue\n      if (this.queue.length > 0) {\n        const next = this.queue.shift()!;\n        this.synthesis.speak(next);\n      }\n    };\n\n    utterance.onerror = (event) => {\n      this.isSpeaking = false;\n      this.emit('error', new Error(`TTS error: ${event.error}`));\n    };\n\n    // If currently speaking, queue it\n    if (this.isSpeaking) {\n      this.queue.push(utterance);\n    } else {\n      this.synthesis.speak(utterance);\n    }\n  }\n\n  /**\n   * Stop speaking immediately\n   */\n  stop(): void {\n    this.synthesis.cancel();\n    this.queue = [];\n    this.isSpeaking = false;\n  }\n\n  /**\n   * Pause speaking\n   */\n  pause(): void {\n    if (this.synthesis.speaking) {\n      this.synthesis.pause();\n    }\n  }\n\n  /**\n   * Resume speaking\n   */\n  resume(): void {\n    if (this.synthesis.paused) {\n      this.synthesis.resume();\n    }\n  }\n\n  /**\n   * Check if currently speaking\n   */\n  isActive(): boolean {\n    return this.isSpeaking || this.synthesis.speaking;\n  }\n\n  /**\n   * Get available voices\n   *\n   * @returns List of available speech synthesis voices\n   */\n  getVoices(): SpeechSynthesisVoice[] {\n    return this.synthesis.getVoices();\n  }\n\n  /**\n   * Get voices for a specific language\n   *\n   * @param language - Language code (e.g., 'en-US')\n   * @returns Voices matching the language\n   */\n  getVoicesForLanguage(language: string): SpeechSynthesisVoice[] {\n    return this.getVoices().filter(voice => voice.lang.startsWith(language));\n  }\n\n  /**\n   * Register event listener\n   *\n   * Events:\n   * - 'start': Fired when speech starts\n   * - 'end': Fired when speech ends\n   * - 'error': Fired when an error occurs\n   *\n   * @param event - Event name\n   * @param callback - Event callback\n   */\n  on(event: string, callback: Function): void {\n    if (!this.listeners.has(event)) {\n      this.listeners.set(event, new Set());\n    }\n\n    this.listeners.get(event)!.add(callback);\n  }\n\n  /**\n   * Remove event listener\n   *\n   * @param event - Event name\n   * @param callback - Event callback\n   */\n  off(event: string, callback: Function): void {\n    const callbacks = this.listeners.get(event);\n    if (callbacks) {\n      callbacks.delete(callback);\n    }\n  }\n\n  /**\n   * Emit event to all listeners\n   *\n   * @param event - Event name\n   * @param data - Event data\n   */\n  private emit(event: string, data?: any): void {\n    const callbacks = this.listeners.get(event);\n    if (callbacks) {\n      callbacks.forEach(callback => callback(data));\n    }\n  }\n\n  /**\n   * Get current configuration\n   */\n  getConfig(): Readonly<Required<SpeakerConfig>> {\n    return { ...this.config };\n  }\n\n  /**\n   * Get queue length\n   */\n  getQueueLength(): number {\n    return this.queue.length;\n  }\n}\n","import type { Gateway } from '../core/gateway.js';\nimport type { ConversationConfig } from './types.js';\nimport { SpeechRecognizer } from './recognizer.js';\nimport { Speaker } from './speaker.js';\n\n/**\n * Conversation orchestrator for continuous voice interaction\n *\n * Manages the loop of:\n * 1. Listen for user speech\n * 2. Send to AI gateway\n * 3. Speak AI response\n * 4. Repeat (if continuous mode enabled)\n *\n * @example\n * ```typescript\n * const conversation = new Conversation(gateway, {\n *   continuous: true,\n *   autoSpeak: true\n * });\n *\n * conversation.on('transcript', (text) => {\n *   console.log('User said:', text);\n * });\n *\n * conversation.on('response', (text) => {\n *   console.log('AI said:', text);\n * });\n *\n * await conversation.start();\n * ```\n */\nexport class Conversation {\n  private gateway: Gateway;\n  private recognizer: SpeechRecognizer;\n  private speaker: Speaker;\n  private config: Required<ConversationConfig>;\n  private listeners: Map<string, Set<Function>> = new Map();\n  private isActive = false;\n  private shouldContinue = false;\n\n  constructor(gateway: Gateway, config: ConversationConfig = {}) {\n    this.gateway = gateway;\n\n    this.config = {\n      continuous: config.continuous ?? false,\n      autoSpeak: config.autoSpeak ?? true,\n      recognizer: config.recognizer ?? {},\n      speaker: config.speaker ?? {},\n    };\n\n    // Initialize recognizer with continuous mode matching conversation mode\n    this.recognizer = new SpeechRecognizer({\n      ...this.config.recognizer,\n      continuous: false, // We handle continuation at conversation level\n    });\n\n    this.speaker = new Speaker(this.config.speaker);\n\n    this.setupEventHandlers();\n  }\n\n  /**\n   * Set up event handlers for recognizer and speaker\n   */\n  private setupEventHandlers(): void {\n    // Handle recognition results\n    this.recognizer.on('result', async (result: any) => {\n      if (!result.isFinal) {\n        // Emit interim results\n        this.emit('interim', result.transcript);\n        return;\n      }\n\n      const transcript = result.transcript;\n      this.emit('transcript', transcript);\n\n      try {\n        // Send to AI gateway\n        const response = await this.gateway.complete(transcript);\n        this.emit('response', response);\n\n        // Speak response if autoSpeak is enabled\n        if (this.config.autoSpeak) {\n          this.speaker.speak(response);\n        }\n      } catch (error) {\n        this.emit('error', error);\n      }\n    });\n\n    // Handle recognition errors\n    this.recognizer.on('error', (error: Error) => {\n      this.emit('error', error);\n    });\n\n    // Handle recognition end\n    this.recognizer.on('end', () => {\n      // If continuous mode and not stopped, resume listening after speaker finishes\n      if (this.shouldContinue && this.config.autoSpeak) {\n        // Wait for speaker to finish before resuming\n        if (!this.speaker.isActive()) {\n          this.resumeListening();\n        }\n      }\n    });\n\n    // Handle speaker end\n    this.speaker.on('end', () => {\n      // Resume listening if continuous mode\n      if (this.shouldContinue && !this.recognizer.isActive()) {\n        this.resumeListening();\n      }\n    });\n\n    // Handle speaker errors\n    this.speaker.on('error', (error: Error) => {\n      this.emit('error', error);\n    });\n  }\n\n  /**\n   * Resume listening after a delay\n   */\n  private resumeListening(): void {\n    // Small delay before resuming to avoid picking up the tail of TTS\n    setTimeout(() => {\n      if (this.shouldContinue) {\n        this.recognizer.startListening().catch(error => {\n          this.emit('error', error);\n        });\n      }\n    }, 500);\n  }\n\n  /**\n   * Start conversation\n   */\n  async start(): Promise<void> {\n    this.isActive = true;\n    this.shouldContinue = this.config.continuous;\n\n    this.emit('start');\n    await this.recognizer.startListening();\n  }\n\n  /**\n   * Stop conversation\n   */\n  stop(): void {\n    this.isActive = false;\n    this.shouldContinue = false;\n\n    this.recognizer.stopListening();\n    this.speaker.stop();\n\n    this.emit('stop');\n  }\n\n  /**\n   * Toggle conversation on/off\n   */\n  async toggle(): Promise<void> {\n    if (this.isActive) {\n      this.stop();\n    } else {\n      await this.start();\n    }\n  }\n\n  /**\n   * Pause conversation (temporary stop)\n   */\n  pause(): void {\n    this.recognizer.stopListening();\n    this.speaker.pause();\n    this.emit('pause');\n  }\n\n  /**\n   * Resume conversation after pause\n   */\n  async resume(): Promise<void> {\n    this.speaker.resume();\n    await this.recognizer.startListening();\n    this.emit('resume');\n  }\n\n  /**\n   * Check if conversation is active\n   */\n  isRunning(): boolean {\n    return this.isActive;\n  }\n\n  /**\n   * Check if recognizer is listening\n   */\n  isListening(): boolean {\n    return this.recognizer.isActive();\n  }\n\n  /**\n   * Check if speaker is speaking\n   */\n  isSpeaking(): boolean {\n    return this.speaker.isActive();\n  }\n\n  /**\n   * Get available voices\n   */\n  getVoices(): SpeechSynthesisVoice[] {\n    return this.speaker.getVoices();\n  }\n\n  /**\n   * Register event listener\n   *\n   * Events:\n   * - 'start': Conversation started\n   * - 'stop': Conversation stopped\n   * - 'pause': Conversation paused\n   * - 'resume': Conversation resumed\n   * - 'interim': Interim transcript (while still speaking)\n   * - 'transcript': Final transcript from user\n   * - 'response': AI response text\n   * - 'error': Error occurred\n   *\n   * @param event - Event name\n   * @param callback - Event callback\n   */\n  on(event: string, callback: Function): void {\n    if (!this.listeners.has(event)) {\n      this.listeners.set(event, new Set());\n    }\n\n    this.listeners.get(event)!.add(callback);\n  }\n\n  /**\n   * Remove event listener\n   *\n   * @param event - Event name\n   * @param callback - Event callback\n   */\n  off(event: string, callback: Function): void {\n    const callbacks = this.listeners.get(event);\n    if (callbacks) {\n      callbacks.delete(callback);\n    }\n  }\n\n  /**\n   * Emit event to all listeners\n   *\n   * @param event - Event name\n   * @param data - Event data\n   */\n  private emit(event: string, data?: any): void {\n    const callbacks = this.listeners.get(event);\n    if (callbacks) {\n      callbacks.forEach(callback => callback(data));\n    }\n  }\n\n  /**\n   * Get current configuration\n   */\n  getConfig(): Readonly<Required<ConversationConfig>> {\n    return { ...this.config };\n  }\n}\n","/**\n * Cognigate - AI Gateway with Budget Controls\n *\n * Build AI apps without fear. Never overspend, never go down.\n */\n\nimport { Gateway } from './core/gateway.js';\nimport type { GatewayConfig } from './utils/types.js';\n\n/**\n * Create a new Cognigate gateway instance\n *\n * @param config - Gateway configuration\n * @returns Gateway instance\n *\n * @example\n * ```typescript\n * import { createGateway } from 'cognigate';\n *\n * const ai = createGateway({\n *   dailyBudget: 10,\n *   cloudProviders: {\n *     openai: { apiKey: process.env.OPENAI_API_KEY }\n *   },\n *   localFallback: { enabled: true }\n * });\n *\n * const response = await ai.complete(\"Hello, world!\");\n * console.log(response);\n * ```\n */\nexport function createGateway(config: GatewayConfig = {}): Gateway {\n  return new Gateway(config);\n}\n\n// Export Gateway class for advanced usage\nexport { Gateway } from './core/gateway.js';\n\n// Export all types\nexport type {\n  GatewayConfig,\n  CompletionOptions,\n  BudgetStatus,\n  CompletionResult,\n  LocalFallbackConfig,\n  CloudProvidersConfig,\n  ProviderConfig,\n  WebhooksConfig,\n  Provider,\n  CacheEntry,\n} from './utils/types.js';\n\n// Export all errors\nexport {\n  CognigateError,\n  BudgetExceededError,\n  ProviderUnavailableError,\n  CacheError,\n  VoiceModeError,\n  ConfigurationError,\n} from './utils/errors.js';\n\n// Export voice classes and types\nexport {\n  SpeechRecognizer,\n  Speaker,\n  Conversation,\n  VoiceError,\n  VoiceNotSupportedError,\n  VoicePermissionError,\n} from './voice/index.js';\n\nexport type {\n  RecognizerConfig,\n  RecognitionResult,\n  SpeakerConfig,\n  ConversationConfig,\n} from './voice/index.js';\n\n// Export webhook classes and functions\nexport {\n  WebhookManager,\n  sendSlackWebhook,\n  sendDiscordWebhook,\n} from './webhooks/index.js';\n\nexport type {\n  AlertType,\n  AlertSeverity,\n  BudgetAlertData,\n  ProviderFailedData,\n  DailySummaryData,\n  AlertPayload,\n  WebhookResult,\n} from './webhooks/index.js';\n"]}